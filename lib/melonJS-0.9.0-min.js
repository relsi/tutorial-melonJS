/*!
 * MelonJS Game Engine
 * Copyright (C) 2011, Olivier BIOT
 * http://www.melonjs.org
 * 
 * melonJS is licensed under a Creative Commons 
 * Attribution-NonCommercial-NoDerivs 3.0 Unported License.
 * http://creativecommons.org/licenses/by-nc-nd/3.0/
 *
 * @author Olivier Biot 2011
 *
 */
(function(h,b){var l=h.document;me={mod:"melonJS",nocache:"",audio:null,video:null,timer:null,input:null,state:null,game:null,entityPool:null,levelDirector:null,XMLParser:null,loadingScreen:null,TMXTileMap:null};me.debug={displayFPS:false,renderHitBox:false};me.sys={ua:navigator.userAgent.toLowerCase(),sound:false,storage:false,gyro:(h.DeviceMotionEvent!==b),fps:60,interpolation:false,scale:1,useNativeAnimFrame:false};h.me=me;var i=false;var j=false,k=false,o=[];function d(){if(!k){if(!l.body){return setTimeout(d,13)}if(l.removeEventListener){l.removeEventListener("DOMContentLoaded",d,false)}else{h.removeEventListener("load",d,false)}k=true;for(var q=0;q<o.length;q++){o[q].call(h,[])}o=[]}}function g(){if(j){return}j=true;if(l.addEventListener){l.addEventListener("DOMContentLoaded",d,false)}h.addEventListener("load",d,false)}onReady=function(q){g();if(k){q.call(h,[])}else{o.push(function(){return q.call(h,[])})}return this};h.onReady(function(){a()});var f=false,m=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;Object.extend=function(v){var t=this.prototype;f=true;var u=new this();f=false;for(var s in v){u[s]=typeof v[s]=="function"&&typeof t[s]=="function"&&m.test(v[s])?(function(w,z){return function(){var B=this.parent;this.parent=t[w];var A=z.apply(this,arguments);this.parent=B;return A}})(s,v[s]):v[s]}function q(){if(!f&&this.init){this.init.apply(this,arguments)}}q.prototype=u;q.constructor=q;q.extend=arguments.callee;return q};if(typeof Object.create!=="function"){Object.create=function(q){function s(){}s.prototype=q;return new s()}}if(!Function.bind){Function.prototype.bind=function(){var t=this,s=Array.prototype.slice.call(arguments),q=s.shift();return function(){return t.apply(q,s.concat(Array.prototype.slice.call(arguments)))}}}String.prototype.trim=function(){return(this.replace(/^\s+/,"")).replace(/\s+$/,"")};String.prototype.isNumeric=function(){return(this!=null&&!isNaN(this)&&this.trim()!="")};String.prototype.isBoolean=function(){return(this!=null&&("true"==this.trim()||"false"==this.trim()))};String.prototype.contains=function(q){return this.indexOf(q)>-1};Number.prototype.clamp=function(q,s){return this<q?q:this>s?s:this};function e(){var q={xmlDoc:null,parser:null,parseFromString:function(s){if(h.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(s,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(s)}if(xmlDoc==null){console.log("xml "+xmlDoc+" not found!")}},getFirstElementByTagName:function(s){return xmlDoc?xmlDoc.getElementsByTagName(s)[0]:null},getAllTagElements:function(){return xmlDoc?xmlDoc.getElementsByTagName("*"):null},getStringAttribute:function(t,v,u){var s=t.getAttribute(v);return s?s.trim().toLowerCase():u},getIntAttribute:function(t,v,u){var s=this.getStringAttribute(t,v,u);return s?parseInt(s):u},getFloatAttribute:function(t,v,u){var s=this.getStringAttribute(t,v,u);return s?parseFloat(s):u},getBooleanAttribute:function(t,v,u){var s=this.getStringAttribute(t,v,u);return s?(s=="true"):u},free:function(){xmlDoc=null;parser=null}};return q}function a(){if(i){return}var q=l.createElement("audio");me.utils.setNocache(l.location.href.match(/\?nocache/));if(q.canPlayType){me.audio.capabilities.mp3=("no"!=q.canPlayType("audio/mpeg"))&&(""!=q.canPlayType("audio/mpeg"));me.audio.capabilities.ogg=("no"!=q.canPlayType('audio/ogg; codecs="vorbis"'))&&(""!=q.canPlayType('audio/ogg; codecs="vorbis"'));me.audio.capabilities.wav=("no"!=q.canPlayType('audio/wav; codecs="1"'))&&(""!=q.canPlayType('audio/wav; codecs="1"'));me.sys.sound=me.audio.capabilities.mp3||me.audio.capabilities.ogg||me.audio.capabilities.wav}if((me.sys.ua.search("iphone")>-1)||(me.sys.ua.search("ipod")>-1)||(me.sys.ua.search("ipad")>-1)||(me.sys.ua.search("android")>-1)){me.sys.sound=false}me.timer.init();me.XMLParser=new e();me.loadingScreen=new me.DefaultLoadingScreen();me.state.init();me.entityPool.init();me.levelDirector.reset();i=true}game=(function(){var w={};var C=0;var z=0;var B=null;var v=[];var q=0;var A=false;var u=true;var t=false;var s=[];w.viewport=null;w.HUD=null;w.collisionMap=null;w.currentLevel=null;w.NO_OBJECT=0;w.ENEMY_OBJECT=1;w.COLLECTABLE_OBJECT=2;w.ACTION_OBJECT=3;w.init=function(E,G,F,D){if(!t){E=E||0;G=G||0;var F=F||me.video.getWidth();var D=D||me.video.getHeight();spriteCanvasSurface=me.video.createCanvasSurface(F,D);w.viewport=new me.Viewport(0,0,F,D);B=me.video.getScreenFrameBuffer();t=true}};w.reset=function(){if(!t){w.init()}w.removeAll();if(w.viewport){w.viewport.reset()}u=true};w.loadTMXLevel=function(G){w.currentLevel=G;w.collisionMap=w.currentLevel.getLayerByName("collision");if(!w.collisionMap||!w.collisionMap.isCollisionMap){alert("WARNING : no collision map detected")}w.currentLevel.addTo(me.game);w.viewport.setBounds(w.currentLevel.realwidth,w.currentLevel.realheight);var D=w.currentLevel.getObjectGroups();for(var F=0;F<D.length;F++){for(var E=0;E<D[F].objects.length;E++){w.addEntity(D[F].objects[E],D[F].z)}}w.sort()};w.add=function(D,E){D.z=(E)?E:D.z;v.push(D);if(D.mouseEvent){s.push(D)}q=v.length};w.addEntity=function(D,E){w.add(me.entityPool.newIstanceOf(D),E)};w.addHUD=function(D,H,E,G,F){if(w.HUD==null){w.HUD=new me.HUD_Object(D,H,E,G,F)}};w.disableHUD=function(){if(w.HUD!=null){w.HUD=null}};w.mouseEvent=function(D,F){for(var E=s.length;E--;){s[E].mouseEvent(D,F)}};w.update=function(){me.timer.update();for(var D=q,E;D--,E=v[D];){if(E.update()){u=true}if(E.isEntity&&!E.flickering){E.visible=w.viewport.isVisible(E.collisionBox)}}u=w.viewport.update(u)};w.remove=function(D){v.splice(v.indexOf(D),1);if(D.mouseEvent){s.splice(s.indexOf(D),1)}q=v.length;u=true};w.removeAll=function(){q=0;v=[];s=[];u=true};w.sort=function(){v.sort(function(E,D){return(D.z-E.z)});u=true};w.collide=function(E){var D=null;for(var F=q,G;F--,G=v[F];){if(G.visible&&G.collidable&&G.isEntity){if(D=G.checkCollision(E)){break}}}return D};w.repaint=function(){u=true};w.draw=function(){if(u){for(var D=q,E;D--,E=v[D];){if(E.visible){E.draw(spriteCanvasSurface,C,z)}}if(w.HUD!=null){w.HUD.draw(spriteCanvasSurface,C,z)}w.viewport.draw(spriteCanvasSurface);B.drawImage(spriteCanvasSurface.canvas,C,z);u=false}};return w})();ScreenObject=Object.extend({visible:true,init:function(q){this.visible=(q===true)||false},reset:function(){me.game.reset();if(this.visible){me.game.add(this,999)}this.onResetEvent.apply(this,arguments);me.game.sort()},destroy:function(){this.onDestroyEvent()},update:function(){return false},onUpdateFrame:function(){me.game.update();me.game.draw();me.video.blitSurface()},draw:function(){},onResetEvent:function(){},onDestroyEvent:function(){}});h.me.ScreenObject=ScreenObject;window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(s,q){return window.setTimeout(s,~~(1000/me.sys.fps))}})();state=(function(){var z={};var u=-1;var E=-1;var A={};var q={color:"",duration:0};var t=null;var B=null;var C=null;var w=null;function v(){if(E==-1){me.timer.reset();if(me.sys.useNativeAnimFrame){E=window.requestAnimFrame(F)}else{E=setInterval(function(){C()},w)}}}function F(){C();if(E!=-1){E=window.requestAnimFrame(F)}}function s(){if(E!=-1){if(me.sys.useNativeAnimFrame){clearTimeout(E)}else{clearInterval(E)}E=-1}}function D(G){s();if(A[u]){A[u].screen.destroy()}A[G].screen.reset.apply(A[G].screen,B);u=G;C=A[u].screen.onUpdateFrame;v();if(t){t()}}z.LOADING=0;z.MENU=1;z.READY=2;z.PLAY=3;z.GAMEOVER=4;z.GAME_END=5;z.SCORE=6;z.CREDITS=7;z.SETTINGS=8;z.init=function(){z.set(z.LOADING,me.loadingScreen);h.addEventListener("blur",function(){if(u!=z.LOADING){z.pause(true)}},false);h.addEventListener("focus",function(){if(u!=z.LOADING){z.resume(true)}},false);w=~~(1000/me.sys.fps)};z.pause=function(G){s();if(G){me.audio.pauseTrack()}};z.resume=function(G){v(u);if(G){me.audio.resumeTrack()}};z.set=function(G,H){A[G]={};A[G].screen=H;A[G].transition=true};z.current=function(){return A[u].screen};z.transition=function(H,G,I){if(H=="fade"){q.color=G;q.duration=I}};z.setTransition=function(H,G){A[H].transition=G};z.change=function(G){switch(G){case z.LOADING:case z.MENU:case z.PLAY:case z.READY:case z.GAMEOVER:case z.GAME_END:case z.SCORE:case z.CREDITS:case z.SETTINGS:B=null;if(arguments.length>1){B=Array.prototype.slice.call(arguments,1)}if(q.duration&&A[G].transition){t=function(){me.game.viewport.fadeOut(q.color,q.duration)};me.game.viewport.fadeIn(q.color,q.duration,function(){D(G)})}else{D(G)}break;default:break}};z.isCurrent=function(G){return u==G};return z})();h.me.state=state;h.me.game=game})(window);(function(b,d){var a=me.ScreenObject.extend({init:function(){this.parent(true);this.logo1=new me.Font("century gothic",32,"white");this.logo2=new me.Font("century gothic",32,"#89b002");this.logo2.bold()},onDestroyEvent:function(){this.logo1=this.logo2=null},update:function(){return true},draw:function(e){var g=e.canvas.height/2;me.video.clearSurface(e,"black");logo1_width=this.logo1.measureText(e,"melon").width;logo_width=logo1_width+this.logo2.measureText(e,"JS").width;this.logo1.draw(e,"melon",((e.canvas.width-logo_width)/2),(e.canvas.height+60)/2);this.logo2.draw(e,"JS",((e.canvas.width-logo_width)/2)+logo1_width,(e.canvas.height+60)/2);g+=40;var f=Math.floor(me.loader.getLoadProgress()*e.canvas.width);e.strokeStyle="silver";e.strokeRect(0,g,e.canvas.width,6);e.fillStyle="#89b002";e.fillRect(2,g+2,f-4,2)},});loader=(function(){var k={};var g=[];var e=[];var m=0;var i=0;var j=0;function h(){if(i==m){for(var q in e){if(e[q].isTMX){me.levelDirector.addTMXLevel(q)}}if(k.onload){j=setTimeout(k.onload,300)}else{alert("no load callback defined")}}else{j=setTimeout(h,100)}}function l(q){console.log("Failing loading image")}function o(q){g.push(q.name);g[q.name]=new Image();g[q.name].onload=k.onRessourceLoaded.bind(k);g[q.name].onerror=l.bind(this);g[q.name].src=q.src+me.nocache}function f(s,q){if(b.XMLHttpRequest){xmlhttp=new XMLHttpRequest();if(xmlhttp.overrideMimeType){xmlhttp.overrideMimeType("text/xml")}}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.open("GET",s.src+me.nocache,false);xmlhttp.onload=k.onRessourceLoaded.bind(k);xmlhttp.send();e[s.name]={};e[s.name].xml=xmlhttp.responseText;e[s.name].isTMX=q||false}k.onload=d;k.onRessourceLoaded=function(q){i++};k.preload=function(s){me.audio.setLoadCallback(k.onRessourceLoaded.bind(k));for(var q=0;q<s.length;q++){switch(s[q].type){case"image":o(s[q]);m+=1;break;case"audio":if(me.audio.isAudioEnable()){me.audio.load(s[q]);m+=1}break;case"tmx":f(s[q],true);m+=1;break;default:alert("error : unknow ressource type : %s",s[q].type);break}}h()};k.getXML=function(q){if(e!=null){return e[q].xml}else{return null}};k.getImage=function(q){if(g!=null){return g[q]}else{return null}};k.getLoadProgress=function(){return i/m};return k})();b.me.loader=loader;b.me.DefaultLoadingScreen=a})(window);(function(a,b){Vector2d=Object.extend({x:0,y:0,init:function(d,e){this.x=d||0;this.y=e||0},set:function(d,e){this.x=d;this.y=e},setZero:function(){this.set(0,0)},setV:function(d){this.x=d.x;this.y=d.y},add:function(d){this.x+=d.x;this.y+=d.y},sub:function(d){this.x-=d.x;this.y-=d.y},scale:function(d){this.x*=d.x;this.y*=d.y},div:function(d){this.x/=d;this.y/=d},abs:function(){if(this.x<0){this.x=-this.x}if(this.y<0){this.y=-this.y}},clamp:function(d,e){return new Vector2d(this.x.clamp(d,e),this.y.clamp(d,e))},minV:function(d){this.x=this.x<d.x?this.x:d.x;this.y=this.y<d.y?this.y:d.y},maxV:function(d){this.x=this.x>d.x?this.x:d.x;this.y=this.y>d.y?this.y:d.y},negate:function(){return new Vector2d(-this.x,-this.y)},negateSelf:function(){this.x=-this.x;this.y=-this.y},copy:function(d){this.x=d.x;this.y=d.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var d=this.length();if(d<Number.MIN_VALUE){return 0}var e=1/d;this.x*=e;this.y*=e;return d},dotProduct:function(d){return this.x*d.x+this.y*d.y},distance:function(d){return Math.sqrt((this.x-d.x)*(this.x-d.x)+(this.y-d.y)*(this.y-d.y))},clone:function(){return new Vector2d(this.x,this.y)},toString:function(){return"x:"+this.x+"y:"+this.y},});Rect=Object.extend({pos:null,colPos:null,left:null,right:null,top:null,bottom:null,width:0,height:0,hWidth:0,hHeight:0,tthis:null,trect:null,init:function(e,d,f){this.pos=e;this.colPos=new Vector2d();this.width=d;this.height=f;this.hWidth=~~(d/2);this.hHeight=~~(f/2);this.tthis=new Vector2d();this.trect=new Vector2d();this.__defineGetter__("left",function(){return this.pos.x});this.__defineGetter__("right",function(){return this.pos.x+this.width});this.__defineGetter__("top",function(){return this.pos.y});this.__defineGetter__("bottom",function(){return this.pos.y+this.height})},set:function(e,d,f){this.pos=e;this.width=d;this.height=f;this.hWidth=~~(d/2);this.hHeight=~~(f/2)},adjustSize:function(d,e,g,f){if(d!=-1){this.colPos.x=d;this.width=e;this.hWidth=~~(this.width/2);this.__defineGetter__("left",function(){return this.pos.x+this.colPos.x});this.__defineGetter__("right",function(){return this.pos.x+this.colPos.x+this.width})}if(g!=-1){this.colPos.y=g;this.height=f;this.hHeight=~~(this.height/2);this.__defineGetter__("top",function(){return this.pos.y+this.colPos.y});this.__defineGetter__("bottom",function(){return this.pos.y+this.colPos.y+this.height})}},flipX:function(d){this.colPos.x=d-this.width-this.colPos.x;this.hWidth=~~(this.width/2)},flipY:function(d){this.colPos.y=d-this.height-this.colPos.y;this.hHeight=~~(this.height/2)},checkAxisAligned:function(d){this.tthis.x=this.left;this.tthis.y=this.top;this.trect.x=d.left;this.trect.y=d.top;return(this.tthis.x<this.trect.x+d.width&&this.trect.x<this.tthis.x+this.width&&this.tthis.y<this.trect.y+d.height&&this.trect.y<this.tthis.y+this.height)},collideVsAABB:function(f){p=new Vector2d(0,0);if(this.checkAxisAligned(f)){var e=this.tthis.x+this.hWidth-this.trect.x-f.hWidth;var d=this.tthis.y+this.hHeight-this.trect.y-f.hHeight;p.x=(f.hWidth+this.hWidth)-(e<0?-e:e);p.y=(f.hHeight+this.hHeight)-(d<0?-d:d);if(p.x<p.y){p.y=0;p.x=e<0?-p.x:p.x}else{p.x=0;p.y=d<0?-p.y:p.y}}return p},draw:function(e,d){e.strokeStyle=d||"red";e.strokeRect(this.left-me.game.viewport.pos.x,this.top-me.game.viewport.pos.y,this.width,this.height)}});a.me.Vector2d=Vector2d;a.me.Rect=Rect})(window);(function(b,e){var a=Math.min,d=Math.max;ViewportEntity=me.Rect.extend({AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},limits:null,target:null,follow_axis:0,_shake:null,_fadeIn:null,_fadeOut:null,_deadwidth:0,_deadheight:0,_limitwidth:0,_limitheight:0,init:function(f,k,j,i,g,h){this.parent(new me.Vector2d(f,k),j-f,i-k);this.limits=new me.Vector2d(g||this.width,h||this.height);this.setDeadzone(this.width/6,this.height/6);this.target=null;this.follow_axis=this.AXIS.NONE;this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null};this._fadeOut={color:0,alpha:0,duration:0,onComplete:null};this._fadeIn={color:0,alpha:0,duration:0,onComplete:null}},_followH:function(f){if((f.x-this.pos.x)>(this._deadwidth)){this.pos.x=~~a((f.x)-(this._deadwidth),this._limitwidth)}else{if((f.x-this.pos.x)<(this.deadzone.x)){this.pos.x=~~d((f.x)-this.deadzone.x,0)}}},_followV:function(f){if((f.y-this.pos.y)>(this._deadheight)){this.pos.y=~~a((f.y)-(this._deadheight),this._limitheight)}else{if((f.y-this.pos.y)<(this.deadzone.y)){this.pos.y=~~d((f.y)-this.deadzone.y,0)}}},reset:function(f,g){this.pos.x=f||0;this.pos.y=g||0;this.target=null;this.follow_axis=null},setDeadzone:function(f,g){this.deadzone=new me.Vector2d(~~((this.width-f)/2),~~((this.height-g)/2-g*0.25));this._deadwidth=this.width-this.deadzone.x;this._deadheight=this.height-this.deadzone.y},setBounds:function(f,g){this.limits.set(f,g);this._limitwidth=this.limits.x-this.width;this._limitheight=this.limits.y-this.height},follow:function(g,f){this.target=g;this.follow_axis=f||this.AXIS.NONE},move:function(f,g){newx=~~(this.pos.x+f);newy=~~(this.pos.y+g);if((newx>=0)&&(newx<=this._limitwidth)){this.pos.x=newx}if((newy>=0)&&(newy<=this._limitheight)){this.pos.y=newy}},update:function(h){if(this.target&&(h||(this._shake.duration>0))){switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:this._followH(this.target);break;case this.AXIS.VERTICAL:this._followV(this.target);break;case this.AXIS.BOTH:this._followH(this.target);this._followV(this.target);break;default:break}}if(this._shake.duration>0){this._shake.duration-=me.timer.tick;if(this._shake.duration<0){if(this._shake.onComplete){this._shake.onComplete()}}else{if((this._shake.axis==this.AXIS.BOTH)||(this._shake.axis==this.AXIS.HORIZONTAL)){var g=(Math.random()*this._shake.intensity);if(this.pos.x+this.width+g<this.limits.x){this.pos.x+=~~g}else{this.pos.x-=~~g}}if((this._shake.axis==this.AXIS.BOTH)||(this._shake.axis==this.AXIS.VERTICAL)){var f=(Math.random()*this._shake.intensity);if(this.pos.y+this.height+f<this.limits.y){this.pos.y+=~~f}else{this.pos.y-=~~f}}h=true}}if(this._fadeIn.alpha<1){this._fadeIn.alpha+=me.timer.tick/this._fadeIn.duration;if(this._fadeIn.alpha>=1){this._fadeIn.alpha=1;if(this._fadeIn.onComplete){this._fadeIn.onComplete()}}h=true}if(this._fadeOut.alpha>0){this._fadeOut.alpha-=me.timer.tick/this._fadeOut.duration;if(this._fadeOut.alpha<=0){this._fadeOut.alpha=0;if(this._fadeOut.onComplete){this._fadeOut.onComplete()}}h=true}return h},shake:function(f,i,g,h){g=g||this.AXIS.BOTH;if(g==this.AXIS.BOTH){if(this.width==this.limits.x){g=this.AXIS.VERTICAL}else{if(this.height==this.limits.y){g=this.AXIS.HORIZONTAL}}}if((g==this.AXIS.HORIZONTAL)&&(this.width==this.limits.x)){return}if((g==this.AXIS.VERTICAL)&&(this.height==this.limits.y)){return}this._shake.intensity=f;this._shake.duration=i;this._shake.axis=g;this._shake.onComplete=h||null},fadeOut:function(f,h,g){this._fadeOut.color=f;this._fadeOut.duration=h||30;this._fadeOut.alpha=1;this._fadeOut.onComplete=g||null},fadeIn:function(f,h,g){this._fadeIn.color=f;this._fadeIn.duration=h||30;this._fadeIn.alpha=0;this._fadeIn.onComplete=g||null},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(f){this.pos.x=f.x-this.width*0.5;this.pos.y=f.y-this.height*0.5},isVisible:function(f){return this.checkAxisAligned(f)},draw:function(f){if(this._fadeIn.alpha<1){me.video.clearSurface(f,me.utils.HexToRGB(this._fadeIn.color,this._fadeIn.alpha))}if(this._fadeOut.alpha>0){me.video.clearSurface(f,me.utils.HexToRGB(this._fadeOut.color,this._fadeOut.alpha))}}});b.me.Viewport=ViewportEntity})(window);(function(d,f){var a=Math.min;ObjectSettings={image:null,spritewidth:null,type:0,collidable:false};me.ObjectSettings=ObjectSettings;entityPool=(function(){var h={};var g={};h.init=function(){h.add("me.LevelEntity",LevelEntity);h.add("me.ObjectEntity",ObjectEntity);h.add("me.CollectableEntity",CollectableEntity);h.add("me.InvisibleEntity",InvisibleEntity)};h.add=function(j,i){g[j.toLowerCase()]=i};h.newIstanceOf=function(i){if(!g[i.name]){alert("cannot instance entity of type '"+i.name+"': Class not found!");return null}return new g[i.name](i.x,i.y,i)};return h})();d.me.entityPool=entityPool;function e(g,i,h){this.image=me.loader.getImage(g);this.imageWidth=this.image.width;this.imageHeight=this.image.height;this.baseOffset=0;this.z=h||0;this.scrollspeed=i;this.vp_width=me.game.viewport.width}e.prototype.draw=function(j,g,k){var i=0;var h=a(this.imageWidth-g,this.vp_width);do{j.drawImage(this.image,g,0,h,this.imageHeight,i,k,h,this.imageHeight);i+=h;g=0;h=a(this.imageWidth,this.vp_width-i)}while((i<this.vp_width))};function b(g){this.name="parallaxBackgroundEntity";this.visible=true;this.z=g||0;this.vp=me.game.viewport.pos;this.lastx=this.vp.x;this.parallaxLayers=[];this.parallaxLayersCount=0;this.addLayer=function(h,j,i){this.parallaxLayers.push(new e(h,j,i));this.parallaxLayersCount=0};this.clearTile=function(h,i){};this.update=function(){return false};this.draw=function(l,h,m){h=this.vp.x;if(h>this.lastx){for(var k=0,j;j=this.parallaxLayers[k++];){j.baseOffset=(j.baseOffset+j.scrollspeed*me.timer.tick)%j.imageWidth;j.draw(l,~~j.baseOffset,m);this.lastx=h}return}else{if(h<this.lastx){for(var k=0,j;j=this.parallaxLayers[k++];){j.baseOffset=(j.imageWidth+(j.baseOffset-j.scrollspeed*me.timer.tick))%j.imageWidth;j.draw(l,~~j.baseOffset,m);this.lastx=h}return}}for(var k=0,j;j=this.parallaxLayers[k++];){j.draw(l,~~j.baseOffset,m);this.lastx=h}}}d.me.ParallaxBackgroundEntity=b;SpriteObject=me.Rect.extend({scale:null,lastflipX:false,lastflipY:false,z:0,currentSpriteOff:0,scaleFlag:false,autodestroy:true,visible:true,image:null,collisionBox:null,vp:null,init:function(g,i,h){this.parent(new me.Vector2d(g,i),h.width,h.height);this.scale=new me.Vector2d(1,1);this.image=h;this.collisionBox=new me.Rect(this.pos,this.width,this.height);this.vp=me.game.viewport},flipX:function(g){if(g!=this.lastflipX){this.lastflipX=g;this.scale.x=-this.scale.x;this.scaleFlag=((this.scale.x!=1)||(this.scale.y!=1));this.collisionBox.flipX(this.width)}},flipY:function(g){if(g!=this.lastflipY){this.lastflipY=g;this.scale.y=-this.scale.y;this.scaleFlag=((this.scale.x!=1)||(this.scale.y!=1));this.collisionBox.flipY(this.height)}},update:function(){return false},draw:function(h){var g=this.pos.x-this.vp.pos.x,i=this.pos.y-this.vp.pos.y;if(this.scaleFlag){h.scale(this.scale.x,this.scale.y);g=(g*this.scale.x)-(this.scale.x<0?this.width:0);i=(i*this.scale.y)-(this.scale.y<0?this.height:0)}h.drawImage(this.image,this.currentSpriteOff,0,this.width,this.height,~~g,~~i,this.width,this.height);if(this.scaleFlag){h.setTransform(1,0,0,1,0,0)}if(me.debug.renderHitBox){this.parent(h,"blue");this.collisionBox.draw(h,"red")}},destroy:function(){this.onDestroyEvent();if(this.autodestroy){this.image=null;me.game.remove(this)}},onDestroyEvent:function(){}});d.me.SpriteObject=SpriteObject;AnimatedSpriteObject=SpriteObject.extend({currentSprite:0,currentSpriteOff:0,fpscount:0,init:function(g,j,i,h){this.parent(g,j,i);this.animationspeed=me.sys.fps/10;this.width=h;this.spritecount=~~(this.image.width/h);this.collisionBox.set(this.pos,this.width,this.height);this.currentSpriteOff=0},setCurrentSprite:function(g){this.currentSprite=g;this.currentSpriteOff=this.width*g},update:function(){if(this.visible&&(this.fpscount++>this.animationspeed)){this.setCurrentSprite(++thiscurrentSprite%this.spritecount);this.fpscount=0;return true}return false},});d.me.AnimatedSpriteObject=AnimatedSpriteObject;AnimationSheet=me.AnimatedSpriteObject.extend({init:function(g,j,i,h){this.anim=[];this.resetAnim=null;this.current=null;this.parent(g,j,i,h);if(this.image.width==h){this.update=function(){return false}}else{this.addAnimation("default",null);this.setCurrentAnimation("default")}},addAnimation:function(h,k){this.anim[h]={name:null,frame:[],idx:0,length:0};if(k==null){for(var j=0;j<this.spritecount;j++){this.anim[h].frame[j]=j*this.width}}else{var g=0;for(var j=0;j<k.length;j++){this.anim[h].frame[g]=k[j]*this.width;g++}}this.anim[h].name=h;this.anim[h].length=this.anim[h].frame.length},setCurrentAnimation:function(g,h){this.current=this.anim[g];this.resetAnim=h||null;this.currentSpriteOff=this.current.frame[this.current.idx]},isCurrentAnimation:function(g){return(this.current.name==g)},setCurrentSprite:function(g){this.current.idx=g;this.currentSpriteOff=this.current.frame[g]},update:function(){if(this.visible&&(this.fpscount++>this.animationspeed)){this.setCurrentSprite(++this.current.idx%this.current.length);if((this.current.idx==0)&&this.resetAnim){this.setCurrentAnimation(this.resetAnim)}this.fpscount=0;return true}return false}});d.me.AnimationSheet=AnimationSheet;ObjectEntity=AnimationSheet.extend({type:0,collidable:false,init:function(g,i,h){this.parent(g,i,(typeof h.image=="string")?me.loader.getImage(h.image):h.image,h.spritewidth);this.pos.set(g,i+me.game.currentLevel.tileheight-this.height);this.vel=new me.Vector2d();this.accel=new me.Vector2d();this.gravity=0.98;this.isEntity=true;this.canBreakTile=false;this.alive=true;this.falling=false;this.jumping=false;this.jumpspeed=0;this.slopeY=0;this.onslope=false;this.onladder=false;this.collidable=h.collidable||false;this.type=h.type||0;this.flickering=false;this.flickerTimer=-1;this.flickercb=null;this.collisionMap=me.game.collisionMap;this.onTileBreak=null},updateColRect:function(g,i,k,j){this.collisionBox.adjustSize(g,i,k,j)},checkCollision:function(h){var g=this.collisionBox.collideVsAABB(h.collisionBox);if(g.x!=0||g.y!=0){this.onCollision(g,h);g.type=this.type;return g}return null},onCollision:function(g,h){if(this.collidable&&(this.type==me.game.COLLECTABLE_OBJECT)){this.destroy()}},setVelocity:function(g,h){this.accel.x=(g!=0)?g:this.accel.x;this.accel.y=(g!=0)?h:this.accel.y},doWalk:function(g){this.flipX(g);this.vel.x=(g)?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick},doClimb:function(g){if(this.onladder){this.vel.y=(g)?-this.accel.x*me.timer.tick:this.accel.x*me.timer.tick;return true}return false},doJump:function(){if(!this.jumping&&!this.falling){this.jumpspeed=this.accel.y;this.jumping=true;if(this.onslope){}return true}return false},forceJump:function(){this.jumping=false;this.falling=false;this.doJump()},checkSlope:function(g,h){this.pos.y=g.pos.y-this.height;if(h){this.slopeY=g.height-(this.collisionBox.right+this.vel.x-g.pos.x)}else{this.slopeY=(this.collisionBox.left+this.vel.x-g.pos.x)}this.slopeY=this.slopeY.clamp(0,g.height);if((this.vel.x!=0)||this.falling){this.vel.y=this.slopeY}else{this.vel.y=0;this.pos.y+=this.slopeY}},updateMovement:function(){if(this.jumping){this.jumpspeed-=this.gravity;if((this.jumpspeed<0)){this.jumping=false;this.falling=true;this.vel.y=0}else{this.vel.y=-this.jumpspeed}}else{if(!this.onladder){this.falling=true;this.vel.y+=(this.gravity*me.timer.tick)}}collision=this.collisionMap.checkCollision(this.collisionBox,this.vel);this.onladder=collision.xprop.isLadder;this.onslope=collision.yprop.isSlope||collision.xprop.isSlope;if(collision.y){if(this.vel.y>0){if(collision.yprop.isSolid||(collision.yprop.isPlatform&&(~~this.pos.y+this.height<=collision.ytile.pos.y))){this.pos.y=~~this.pos.y;this.vel.y=(this.falling)?collision.ytile.pos.y-this.pos.y-this.height:0;this.falling=false}else{if(collision.yprop.isSlope&&!this.jumping){this.checkSlope(collision.ytile,collision.yprop.isLeftSlope);this.falling=false}else{if(collision.yprop.isBreakable){if(this.canBreakTile){me.game.currentLevel.clearTile(collision.ytile.row,collision.ytile.col);if(this.onTileBreak){this.onTileBreak()}}else{this.pos.y=~~this.pos.y;this.vel.y=(this.falling)?collision.ytile.pos.y-this.pos.y-this.height:0;this.falling=false}}}}}else{if(this.vel.y<0){if(!collision.yprop.isPlatform&&!collision.yprop.isLadder){this.jumping=false;this.falling=true;this.vel.y=0}}}}if(collision.x){if(collision.xprop.isSlope&&!this.jumping){this.checkSlope(collision.xtile,collision.xprop.isLeftSlope);this.falling=false}else{if(!collision.xprop.isPlatform&&!collision.xprop.isLadder){if(collision.xprop.isBreakable&&this.canBreakTile){me.game.currentLevel.clearTile(collision.xtile.row,collision.xtile.col);if(this.onTileBreak){this.onTileBreak()}}else{this.vel.x=0}}}}this.updateFlickering();if((this.vel.x!=0)||(this.vel.y!=0)){this.pos.add(this.vel);if((this.onslope&&!this.jumping)||this.onladder){this.vel.y=0}return true}return false},updateFlickering:function(){if(this.flickering){this.flickerTimer-=me.timer.tick;if(this.flickerTimer<0){if(this.flickercb){this.flickercb()}this.flicker(-1)}else{this.visible=!this.visible;return true}}return false},flicker:function(g,h){this.flickerTimer=g;if(this.flickerTimer<0){this.flickering=false;this.visible=true;this.flickercb=null}else{if(!this.flickering){this.flickercb=h;this.flickering=true}}}});d.me.ObjectEntity=ObjectEntity;CollectableEntity=ObjectEntity.extend({init:function(g,i,h){this.parent(g,i,h);this.collidable=true;this.type=me.game.COLLECTABLE_OBJECT}});d.me.CollectableEntity=CollectableEntity;InvisibleEntity=me.Rect.extend({z:0,collisionBox:null,init:function(g,i,h){this.parent(new me.Vector2d(g,i),h.width,h.height);this.collisionBox=new me.Rect(this.pos,h.width,h.height);this.visible=true;this.collidable=true;this.isEntity=true},updateColRect:function(g,i,k,j){this.collisionBox.adjustSize(g,i,k,j)},checkCollision:function(h){var g=this.collisionBox.collideVsAABB(h.collisionBox);if(g.x!=0||g.y!=0){this.onCollision(g,h);g.type=this.type;return g}return null},onCollision:function(g){if(this.collidable&&(this.type==me.game.COLLECTABLE_OBJECT)){this.destroy()}},update:function(){return false},draw:function(g){if(me.debug.renderHitBox){g.strokeStyle="blue";g.strokeRect(this.pos.x-me.game.viewport.pos.x,this.pos.y-me.game.viewport.pos.y,this.width,this.height);this.collisionBox.draw(g)}}});d.me.InvisibleEntity=InvisibleEntity;LevelEntity=InvisibleEntity.extend({init:function(g,i,h){this.parent(g,i,h);this.nextlevel=h.to;this.fade=h.fade;this.duration=h.duration;this.fading=false;this.gotolevel=h.to},onFadeComplete:function(){me.levelDirector.loadLevel(this.gotolevel);me.game.viewport.fadeOut(this.fade,this.duration)},goTo:function(g){this.gotolevel=g||this.nextlevel;if(this.fade&&this.duration){if(!this.fading){this.fading=true;me.game.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))}}else{me.levelDirector.loadLevel(this.gotolevel)}},onCollision:function(){this.goTo()}});d.me.LevelEntity=LevelEntity})(window);(function(a,b){Font=Object.extend({ALIGN:{LEFT:"left",CENTER:"center",RIGHT:"right"},font:null,height:null,color:null,align:null,init:function(e,f,d,g){this.set(e,f,d,g)},bold:function(){this.font="bold "+this.font},italic:function(){this.font="italic "+this.font},set:function(e,f,d,g){this.font=""+f+"px "+e;this.height=f;this.color=d;this.align=g||"top"},measureText:function(d,e){d.font=this.font;d.fillStyle=this.color;d.textBaseLine=this.align;dim=d.measureText(e);dim.height=this.height;return dim},draw:function(e,f,d,g){e.font=this.font;e.fillStyle=this.color;e.textBaseLine=this.align;e.fillText(f,~~d,~~g)}});BitmapFont=Font.extend({size:null,sSize:null,scale:1,firstChar:32,init:function(d,e,g,f){this.parent(d,null,null);this.size=new me.Vector2d(e,0);this.sSize=new me.Vector2d();this.scale=g||1;this.firstChar=f||32;this.loadFontMetrics(d);this.align=this.ALIGN.RIGHT},loadFontMetrics:function(d){this.font=me.loader.getImage(d);this.size.y=this.font.height||0;this.sSize.copy(this.size);this.sSize.x*=this.scale;this.sSize.y*=this.scale},set:function(e,d){this.align=e;if(d){this.sSize.copy(this.size);this.sSize.x*=this.scale;this.sSize.y*=this.scale}},measureText:function(d){return{width:d.length*this.sSize.x,height:this.sSize.y}},draw:function(f,g,d,h){if(typeof(g)!="string"){g=g.toString()}if(this.align==this.ALIGN.RIGHT){d-=g.length*this.sSize.x}for(var e=0;e<g.length;e++){f.drawImage(this.font,(g.charCodeAt(e)-this.firstChar)*this.size.x,0,this.sSize.x,this.sSize.y,~~d,~~h,this.size.x,this.size.y);d+=this.sSize.x}}});a.me.Font=Font;a.me.BitmapFont=BitmapFont})(window);(function(b,d){var a=me.AnimatedSpriteObject.extend({isClickable:true,updated:false,init:function(e,h,g,f){this.parent(this,e,h,g,f)},update:function(){if(this.updated){this.updated=false;return true}return false},clicked:function(){return false},mouseEvent:function(e,f){if((e>this.pos.x)&&(e<this.pos.x+this.displayWidth)&&(f>this.pos.y)&&(f<this.pos.y+this.displayHeight)){if(this.isClickable){this.updated=this.clicked()}}return this.updated}});b.me.GUI_Object=a})(window);(function(b,d){HUD_Item=Object.extend({init:function(e,g,f){this.pos=new me.Vector2d(e||0,g||0);this.visible=true;this.defaultvalue=f||0;this.value=f||0;this.updated=true},reset:function(){this.value=this.defaultvalue;this.updated=true},update:function(e){this.value+=e;this.updated=true;return this.updated},draw:function(f,e,g){if(this.updated){this.updated=false}}});function a(e,j,f,i,g){this.pos=new me.Vector2d(e||0,j||0);this.width=f||me.video.getWidth();this.height=i||me.video.getHeight();this.bgcolor=g;this.HUDItems={};this.HUDobj=[];this.visible=true;this.HUD_invalidated=true;HUDCanvasSurface=me.video.createCanvasSurface(this.width,this.height);this.z=999;this.objCount=0}a.prototype.addItem=function(e,f){this.HUDItems[e]=f;this.HUDobj.push(this.HUDItems[e]);this.objCount++;this.HUD_invalidated=true};a.prototype.updateItemValue=function(e,f){if(this.HUDItems[e]&&(this.HUDItems[e].update(f)==true)){this.HUD_invalidated=true}};a.prototype.getItemValue=function(e){return(this.HUDItems[e])?this.HUDItems[e].value:0};a.prototype.update=function(){return this.HUD_invalidated};a.prototype.reset=function(e){if(this.HUDItems[e]){this.HUDItems[e].reset()}this.HUD_invalidated=true};a.prototype.resetAll=function(){for(var e=this.objCount,f;e--,f=this.HUDobj[e];){f.reset()}this.HUD_invalidated=true};a.prototype.draw=function(g,e,j){if(this.HUD_invalidated){if(this.bgcolor){me.video.clearSurface(HUDCanvasSurface,this.bgcolor)}else{HUDCanvasSurface.canvas.width=HUDCanvasSurface.canvas.width}for(var f=this.objCount,h;f--,h=this.HUDobj[f];){if(h.visible){h.draw(HUDCanvasSurface,e,j)}}}g.drawImage(HUDCanvasSurface.canvas,this.pos.x,this.pos.y);this.HUD_invalidated=false};b.me.HUD_Item=HUD_Item;b.me.HUD_Object=a})(window);(function(a,b){audio=(function(){var k={};var u=[];var d=["mp3","ogg","wav"];var h=null;var t=-1;var f=null;var m=null;var l=true;var s=0;function i(){var v=0;if(!me.sys.sound){l=false;return}if((h.search(/mp3/i)!=-1)&&k.capabilities.mp3){return d[v]}if((h.search(/ogg/i)!=-1)&&k.capabilities.ogg){return d[++v]}if((h.search(/wav/i)!=-1)&&k.capabilities.wav){return d[++v]}l=false;return -1}function g(w){var v=u[w];for(var z=0,A;A=v[z++];){if(A.ended||!A.currentTime){A.currentTime=s;return A}}v[0].pause();v[0].currentTime=s;return v[0]}function o(v){u[v][0].load()}function e(v,z){if(z>1){var w=u[v][0];for(channel=1;channel<z;channel++){u[v][channel]=w.cloneNode(true);u[v][channel].load()}}if(f){f()}}function q(w,v,A){var z=g(w);z.loop=v||false;z.play();if(A&&!v){z.addEventListener("ended",function(B){z.removeEventListener("ended",arguments.callee,false);A()},false)}}function j(w,v,z){if(z&&!v){setTimeout(z,2000)}}k.capabilities={mp3:false,ogg:false,ma4:false,wav:false,};k.init=function(v){if(v){h=new String(v)}else{h=new String("mp3")}t=i();if(l){k.play=q}else{k.play=j}return l};k.setLoadCallback=function(v){f=v};k.isAudioEnable=function(){return l};k.enable=function(){l=me.sys.sound;if(l){k.play=q}else{k.play=j}};k.disable=function(){l=false;k.play=j};k.load=function(w){if(t==-1){return 0}var v=new Audio(w.src+w.name+"."+t+me.nocache);v.preload="auto";v.addEventListener("canplaythrough",function(z){this.removeEventListener("canplaythrough",arguments.callee,false);e(w.name,w.channel)},false);v.addEventListener("error",function(z){o(w.name)},false);v.src=w.src+w.name+"."+t+me.nocache;v.load();u[w.name]=[v];return 1};k.stop=function(v){if(l){var w=u[v];for(channel_id=w.length;channel_id--;){w[channel_id].pause();w[channel_id].currentTime=s}}};k.pause=function(v){if(l){var w=u[v];for(channel_id=w.length;channel_id--;){w[channel_id].pause()}}};k.playTrack=function(v){if(l){if(m!=null){k.stopTrack()}m=g(v);if(m){m.loop=true;m.play()}}};k.stopTrack=function(){if(l&&m){m.pause();m=null}};k.pauseTrack=function(){if(l&&m){m.pause()}};k.resumeTrack=function(){if(l&&m){m.play()}};return k})();a.me.audio=audio})(window);(function(a,b){timer=(function(){var h={};var o=null;var d=false;var i=0;var j=0;var f=0;var m=0;var e=0;var l=0;var g=Math.ceil(1000/me.sys.fps);var q=(1000/me.sys.fps)*1.25;function k(){o.replaceChild(document.createTextNode("("+f+"/"+me.sys.fps+" fps)"),o.firstChild)}h.tick=1;h.init=function(){o=document.getElementById("framecounter");d=(o!==null);h.reset()};h.reset=function(){e=m=new Date().getTime();j=0;i=0};h.getTime=function(){return e};h.update=function(){m=e;e=new Date().getTime();l=(e-m);if(d){i++;j+=l;if(i%10==0){f=Math.ceil((1000*i)/j);k();j=0;i=0}}h.tick=(l>q&&me.sys.interpolation)?l/g:1};return h})();video=(function(){var g={};var f=null;var j=null;var k=null;var i=null;var e=null;var l=false;var h=0;var d=0;g.init=function(q,t,o,m,s){l=m;me.sys.scale=l===true?s:1;h=t*me.sys.scale;d=o*me.sys.scale;e=document.getElementById(q);f=document.createElement("canvas");f.setAttribute("width",(h)+"px");f.setAttribute("height",(d)+"px");f.setAttribute("border","0px solid black");e.appendChild(f);if(f.getContext){j=f.getContext("2d");if(l){i=g.createCanvasSurface(t,o);k=i.canvas}else{i=j;k=j.canvas}}else{return false}return true};g.getWrapper=function(){return e};g.getWidth=function(){return k.width};g.getHeight=function(){return k.height};g.createCanvasSurface=function(o,m){var q=document.createElement("canvas");q.width=o||k.width;q.height=m||k.height;return q.getContext("2d")};g.getScreenCanvas=function(){return f};g.getScreenFrameBuffer=function(){return i};g.updateDisplaySize=function(m){if(l){if(m){me.sys.scale=m}else{me.sys.scale=document.getElementById("screen size").value}h=k.width*me.sys.scale;d=k.height*me.sys.scale;f.width=h;f.height=d}};g.clearSurface=function(o,m){o.fillStyle=m;o.fillRect(0,0,o.canvas.width,o.canvas.height)};g.scale=function(m,o){m.translate(-(((m.canvas.width*o)-m.canvas.width)>>1),-(((m.canvas.height*o)-m.canvas.height)>>1));m.scale(o,o)};g.setAlpha=function(o,m){o.globalCompositeOperation=m?"source-over":"copy"};g.blitSurface=function(){if(l){g.blitSurface=function(){j.drawImage(k,0,0,k.width,k.height,0,0,h,d)}}else{g.blitSurface=function(){}}g.blitSurface()};g.applyEffect=function(z,s){var t=g.createCanvasSurface();var u=i.getImageData(0,0,k.width,k.height);var v=u.data;switch(z){case"b&w":for(var q=0,o=v.length;q<o;q+=4){var m=(3*v[q]+4*v[q+1]+v[q+2])>>>3;v[q]=m;v[q+1]=m;v[q+2]=m}break;case"brightness":var w=Math.abs(s);w=(w>1)?1:w;for(var q=0,o=v.length;q<o;q+=4){v[q]*=w;v[q+1]*=w;v[q+2]*=w}break;default:return null}t.putImageData(u,0,0);return t};return g})();a.me.timer=timer;a.me.video=video})(window);(function(a,b){input=(function(){var i={};var g=[];var l=[];var q=[];var e=[];var h=null;var k=null;var o=false;function s(u){if(u){if(!o){a.addEventListener("keydown",f,false);a.addEventListener("keyup",d,false)}}else{a.removeEventListener("keydown",f,false);a.removeEventListener("keyup",d,false)}o=u}function m(u){u.stopPropagation();if(u.preventDefault){u.preventDefault()}u.returnValue=false}function f(v){var u=g[v.keyCode||v.which];if(u){if(!e[u]){l[u]=true;e[u]=q[u]}m(v);return false}return true}function d(v){var u=g[v.keyCode||v.which];if(u){l[u]=false;e[u]=false;m(v);return false}return true}function j(v){var u=v.clientX-me.video.getScreenCanvas().offsetLeft;var w=v.clientY-me.video.getScreenCanvas().offsetTop;h(u,w)}function t(u){}i.KEY={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,};i.isKeyPressed=function(u){if(l[u]){if(q[u]){e[u]=true;l[u]=false}return true}return false};i.keyStatus=function(u){return(e[u]===true)?true:l[u]};i.bindKey=function(u,w,v){if(!o){s(true)}g[u]=w;q[w]=v?v:false;e[w]=false};i.unbindKey=function(u){l[g[u]]=false;q[g[u]]=false;g[u]=null};i.enableMouseEvent=function(u,v){if(u){me.video.getScreenCanvas().addEventListener("click",j,false);h=v}else{me.video.getScreenCanvas().removeEventListener("click",j,false)}};i.enableGyroscopicEvent=function(u,v){if(a.sys.gyro){a.ondevicemotion=u?t:null;k=u?v:null}};return i})();a.me.input=input})(window);(function(b,d){var a=(function(){var g={};var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var h=null;function e(){if(h==null){h={};for(var j=0;j<f.length;j++){h[f[j]]=j}}}g.decodeNumBase64=function(i){e();i=i.replace(new RegExp("[^"+f.join("")+"=]","g"),"");p=(i.charAt(i.length-1)=="="?(i.charAt(i.length-2)=="="?"AA":"A"):"");r=[];i=i.substr(0,i.length-p.length)+p;for(c=0;c<i.length;c+=4){n=(h[i.charAt(c)]<<18)+(h[i.charAt(c+1)]<<12)+(h[i.charAt(c+2)]<<6)+h[i.charAt(c+3)];r.push((n>>>16)&255);r.push((n>>>8)&255);r.push(n&255)}return r};g.setNocache=function(i){me.nocache=i?"?"+parseInt(Math.random()*10000000):""};g.random=function(j,i){return(~~(Math.random()*(i-j+1))+j)};g.round=function(i,k){var j=Math.pow(10,k);return(Math.round(i*j)/j)};g.HexToRGB=function(j,i){j=(j.charAt(0)=="#")?j.substring(1,7):j;rgb=(i?"rgba(":"rgb(")+parseInt(j.substring(0,2),16);rgb+=","+parseInt(j.substring(2,4),16);rgb+=","+parseInt(j.substring(4,6),16)+(i?","+i+")":")");return rgb};return g})();b.me.utils=a})(window);(function(b,d){function a(e){this.defaultvalue=e||0;this.value=e||0;this.updated=true}a.prototype.reset=function(){this.value=this.defaultvalue;this.updated=true};a.prototype.update=function(e){this.value+=e;this.updated=true;return this.updated};gamestat=(function(){var g={};var f={};var h=[];var e=0;g.add=function(i,j){f[i]=new a(j);h.push(f[i]);e++};g.updateValue=function(i,j){if(f[i]){f[i].update(j)}};g.getItemValue=function(i){return(f[i])?f[i].value:0};g.reset=function(i){if(i!=d){if(f[i]){f[i].reset()}}else{g.resetAll()}};g.resetAll=function(){for(var j=e,k;j--,k=h[j];){k.reset()}};return g})();b.me.gamestat=gamestat})(window);(function(g,h){removepath=/^.*(\\|\/|\:)/;removeext=/\.[^\.]*$/;var f={COLLISION_MAP:"collision",PARALLAX_MAP:"parallax",};var d=me.Rect.extend({init:function(j,o,k,l,m){this.parent(new me.Vector2d(j*k,o*l),k,l);this.tileId=m;this.row=j;this.col=o}});function b(l,m,k,q,o,j){this.name=l;this.tilewidth=m;this.tileheight=k;this.spacing=q;this.margin=o;this.image=(j)?me.loader.getImage(j.replace(removepath,"").replace(removeext,"")):null;this.type={SOLID:"solid",PLATFORM:"platform",L_SLOPE:"lslope",R_SLOPE:"rslope",LADDER:"ladder",BREAKABLE:"breakable"};this.TileProperties=[];if(this.image){this.hTileCount=~~((this.image.width-this.margin)/(this.tilewidth+this.spacing));this.vTileCount=~~((this.image.height-this.margin)/(this.tileheight+this.spacing))}}b.prototype.getPropertyList=function(){return{isCollidable:false,isSolid:false,isPlatform:false,isSlope:false,isLeftSlope:false,isRightSlope:false,isLadder:false,isBreakable:false}};b.prototype.getTileProperties=function(j){return this.TileProperties[j]};b.prototype.isTileCollidable=function(j){return this.TileProperties[j].isCollidable};b.prototype.getTileImage=function(k){var j=me.video.createCanvasSurface(this.tilewidth,this.tileheight);this.drawTile(j,0,0,k);return j.canvas};b.prototype.drawTile=function(k,j,q,o){var m=this.margin+(this.spacing+this.tilewidth)*(o%this.hTileCount);var l=this.margin+(this.spacing+this.tileheight)*~~(o/this.hTileCount);k.drawImage(this.image,m,l,this.tilewidth,this.tileheight,j,q,this.tilewidth,this.tileheight)};function e(j,k){this.realwidth=j;this.realheight=k;this.isCollisionMap=true}e.prototype.checkCollision=function(m,k){var j=(k.x<0)?m.left+k.x:m.right+k.x-1;var o=(k.y<0)?m.top+k.y:m.bottom+k.y;var l={x:false,y:false,tile:h,xprop:{},yprop:{}};if(j<=0||j>=this.realwidth){l.x=true}if(o<=0||o>=this.realheight){l.y=true}return l};function i(j,k,l,m){this.width=j;this.height=k;this.z=m;this.name=null;this.visible=false;this.layerData=null;this.xLUT={};this.yLUT={};this.tileset=l;if(l){this.tilewidth=l.tilewidth;this.tileheight=l.tileheight}else{this.tilewidth=0;this.tileheight=0}this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight}i.prototype.initArray=function(k){this.layerData=[];for(var j=0;j<this.width+1;j++){this.layerData[j]=[];for(var l=0;l<this.height+1;l++){this.layerData[j][l]=null}}if(k){for(var j=0;j<this.width*this.tilewidth;j++){this.xLUT[j]=~~(j/this.tilewidth)}for(var l=0;l<this.height*this.tileheight;l++){this.yLUT[l]=~~(l/this.tileheight)}}};i.prototype.getTileId=function(j,l){var k=this.layerData[this.xLUT[~~j]][this.yLUT[~~l]];return k?k.tileId:null};i.prototype.getTile=function(j,k){return this.layerData[this.xLUT[~~j]][this.yLUT[~~k]]};i.prototype.setTile=function(j,l,k){this.layerData[j][l]=new d(j,l,this.tilewidth,this.tileheight,k)};i.prototype.clearTile=function(j,k){this.layerData[j][k]=null};i.prototype.checkCollision=function(k,j){x=(j.x<0)?k.left+j.x:k.right+j.x;y=(j.y<0)?k.top+j.y:k.bottom+j.y;collide={x:false,xtile:h,xprop:{},y:false,ytile:h,yprop:{}};if(x<=0||x>=this.realwidth){collide.x=true}else{collide.xtile=this.getTile(x,k.bottom-1);if(collide.xtile&&this.tileset.isTileCollidable(collide.xtile.tileId)){collide.x=true;collide.xprop=this.tileset.getTileProperties(collide.xtile.tileId)}else{collide.xtile=this.getTile(x,k.top);if(collide.xtile&&this.tileset.isTileCollidable(collide.xtile.tileId)){collide.x=true;collide.xprop=this.tileset.getTileProperties(collide.xtile.tileId)}}}collide.ytile=this.getTile((j.x<0)?k.left:k.right,y);if(collide.ytile&&this.tileset.isTileCollidable(collide.ytile.tileId)){collide.y=true;collide.yprop=this.tileset.getTileProperties(collide.ytile.tileId)}else{collide.ytile=this.getTile((j.x<0)?k.right:k.left,y);if(collide.ytile&&this.tileset.isTileCollidable(collide.ytile.tileId)){collide.y=true;collide.yprop=this.tileset.getTileProperties(collide.ytile.tileId)}}return collide};i.prototype.update=function(){return false};function a(j,k){this.pos=new me.Vector2d(j,k);this.z=0;this.width=0;this.height=0;this.realwidth=-1;this.realheight=-1;this.tilewidth=0;this.tileheight=0;this.tileset=[];this.mapLayers=[];this.objectGroups=[];this.initialized=false}a.prototype.reset=function(){this.tileset=[];this.mapLayers=[];this.objectGroups=[];this.initialized=false};a.prototype.getObjectGroupByName=function(j){return this.objectGroups[j]};a.prototype.getObjectGroups=function(){return this.objectGroups};a.prototype.getLayerByName=function(j){var l=null;j=j.trim().toLowerCase();for(var k=this.mapLayers.length;k--;){if(this.mapLayers[k].name.contains(j)){l=this.mapLayers[k];break}}if((j.contains(f.COLLISION_MAP))&&(l==null)){l=new e(me.game.currentLevel.realwidth,me.game.currentLevel.realheight)}return l};a.prototype.clearTile=function(j,l){for(var k=this.mapLayers.length;k--;){if(this.mapLayers[k].visible||this.mapLayers[k].isCollisionMap){this.mapLayers[k].clearTile(j,l)}}};a.prototype.addTo=function(j){if(this.visible){j.add(this)}for(var k=this.mapLayers.length;k--;){if(this.mapLayers[k].visible){j.add(this.mapLayers[k])}}};a.prototype.update=function(){return false};levelDirector=(function(){var l={};var j={};var k=null;l.reset=function(){};l.addLevel=function(m){console.log("no level loader defined")};l.addTMXLevel=function(m,o){if(j[m]==null){j[m]=new me.TMXTileMap(m,0,0)}if(o){o()}};l.loadLevel=function(m){if(j[m]===h){console.log("level %s not found",m);return}if(j[m] instanceof me.TMXTileMap){me.state.pause();me.game.reset();j[m].reset();j[m].load();k=m;me.game.loadTMXLevel(j[k]);me.state.resume()}else{console.log("no level loader defined")}};l.getCurrentLevelId=function(){return k},l.reloadLevel=function(){return l.loadLevel(k)},l.nextLevel=function(){if(k+1<j.length){return l.loadLevel(k+1)}else{return false}};l.previousLevel=function(){if(k-1>=0){return l.loadLevel(k-1)}else{return false}};return l})();g.me.Tile=d;g.me.TileSet=b;g.me.TiledLayer=i;g.me.TileMap=a;g.me.LevelConstants=f;g.me.levelDirector=levelDirector})(window);(function(D,l){var T="map",E="name",w="value",I="version",Q="orientation",L="width",J="height",H="opacity",q="tilewidth",a="tileheight",s="firstgid",h="gid",z="tile",A="id",o="data",u="compression",k="encoding",e="base64",S="spacing",R="margin",v="properties",m="property",P="image",g="source",j="visible",G="tileset",O="layer",M="objectgroup",t="object",C="x",B="y",L="width",J="height";function f(Y,X){var V=X.getElementsByTagName(v)[0];if(V){var U=V.getElementsByTagName(m);for(var W=0;W<U.length;W++){N(Y,U[W])}}}function N(U,X){var W=me.XMLParser.getStringAttribute(X,E);var V=me.XMLParser.getStringAttribute(X,w);if(!V||V.isBoolean()){V=V?(V=="true"):true}else{if(V.isNumeric()){V=parseInt(V)}}U[W]=V}function K(V,U,W){me.TileMap.call(this,U,W);this.xmlMap=me.loader.getXML(V);if(!this.xmlMap){alert(V+" map not found");return}this.version="";this.orientation="";this.tileMapCanvas=null}K.prototype=new me.TileMap();K.prototype.load=function(){if(this.initialized){return}var Z=0,ab=1;me.XMLParser.parseFromString(this.xmlMap);var ac=me.XMLParser.getAllTagElements();for(var aa=0;aa<ac.length;aa++){var X=ac.item(aa).nodeName;switch(X){case T:var V=ac.item(aa);this.version=me.XMLParser.getStringAttribute(V,I);this.orientation=me.XMLParser.getStringAttribute(V,Q);this.width=me.XMLParser.getIntAttribute(V,L);this.height=me.XMLParser.getIntAttribute(V,J);this.tilewidth=me.XMLParser.getIntAttribute(V,q);this.tileheight=me.XMLParser.getIntAttribute(V,a);this.realwidth=this.width*this.tilewidth;this.realheight=this.height*this.tileheight;this.z=Z++;if(this.orientation!="orthogonal"){alert("%s type tilemap not supported!",this.orientation);return}f(this,V);if(this.background_color){this.visible=true;this.background_color=me.utils.HexToRGB(this.background_color)}else{this.visible=false}break;case G:this.tileset.push(new F(ac.item(aa)));break;case O:var W=me.XMLParser.getStringAttribute(ac.item(aa),E);if(W.contains(me.LevelConstants.COLLISION_MAP)){this.mapLayers.push(new d(ac.item(aa),this.tileset,Z++))}else{if(W.contains(me.LevelConstants.PARALLAX_MAP)){var Y=(me.XMLParser.getIntAttribute(ac.item(aa),j,1)==1);if(Y){var ad={};f(ad,ac.item(aa));parallax_layer=this.getLayerByName(me.LevelConstants.PARALLAX_MAP);if(!parallax_layer){parallax_layer=new me.ParallaxBackgroundEntity(Z);this.mapLayers.push(parallax_layer)}parallax_layer.addLayer(ad.imagesrc,ab++,Z++)}}else{this.mapLayers.push(new d(ac.item(aa),this.tileset,Z++));Z++}}break;case M:var U=me.XMLParser.getStringAttribute(ac.item(aa),E);this.objectGroups.push(new i(U,ac.item(aa),this.tileset[0],Z++));break}}me.XMLParser.free();this.initialized=true};K.prototype.draw=function(U){me.video.clearSurface(U,this.background_color)};function F(V){this.firstgid=me.XMLParser.getIntAttribute(V,s);me.TileSet.call(this,me.XMLParser.getStringAttribute(V,E),me.XMLParser.getIntAttribute(V,q),me.XMLParser.getIntAttribute(V,a),me.XMLParser.getIntAttribute(V,S,0),me.XMLParser.getIntAttribute(V,R,0),V.getElementsByTagName(P)[0].getAttribute(g));var U=V.getElementsByTagName(z);for(var W=0;W<U.length;W++){var X=me.XMLParser.getIntAttribute(U[W],A)+this.firstgid;this.TileProperties[X]={};tileProp=this.TileProperties[X];f(tileProp,U[W]);tileProp.isSolid=tileProp.type?tileProp.type.toLowerCase()===this.type.SOLID:false;tileProp.isPlatform=tileProp.type?tileProp.type.toLowerCase()===this.type.PLATFORM:false;tileProp.isLeftSlope=tileProp.type?tileProp.type.toLowerCase()===this.type.L_SLOPE:false;tileProp.isRightSlope=tileProp.type?tileProp.type.toLowerCase()===this.type.R_SLOPE:false;tileProp.isBreakable=tileProp.type?tileProp.type.toLowerCase()===this.type.BREAKABLE:false;tileProp.isLadder=tileProp.type?tileProp.type.toLowerCase()===this.type.LADDER:false;tileProp.isSlope=tileProp.isLeftSlope||tileProp.isRightSlope;tileProp.isCollidable=tileProp.isSolid||tileProp.isPlatform||tileProp.isSlope||tileProp.isLadder||tileProp.isBreakable}}F.prototype=new me.TileSet();function d(V,Z,X){me.TiledLayer.call(this,me.XMLParser.getIntAttribute(V,L),me.XMLParser.getIntAttribute(V,J),Z[0],X);this.layerInvalidated=true;this.name=me.XMLParser.getStringAttribute(V,E);this.visible=(me.XMLParser.getIntAttribute(V,j,1)==1);this.opacity=me.XMLParser.getFloatAttribute(V,H,1);f(this,V);this.isCollisionMap=(this.name.contains(me.LevelConstants.COLLISION_MAP));if(this.isCollisionMap){this.visible=false;if(Z[1]){this.tileset=Z[1]}}this.vp=me.game.viewport;var Y=V.getElementsByTagName(o)[0];var W=me.XMLParser.getStringAttribute(Y,k);var U=me.XMLParser.getStringAttribute(Y,u);if(this.visible||this.isCollisionMap){this.layerSurface=me.video.createCanvasSurface(this.width*this.tilewidth,this.height*this.tileheight);this.layerCanvas=this.layerSurface.canvas;if(this.opacity>0&&this.opacity<1){this.layerSurface.globalAlpha=this.opacity}this.initArray(this.isCollisionMap);this.fillArray(Y,W,U)}}d.prototype=new me.TiledLayer();d.prototype.fillArray=function(aa,Y,W){if(W!=null){alert(W+" compressed tilemap not supported!");return}if(Y==e){var Z=me.utils.decodeNumBase64(aa.childNodes[0].nodeValue)}else{var Z=aa.getElementsByTagName(z)}var V=0;for(var ab=0;ab<this.height;ab++){for(var U=0;U<this.width;U++){if(Y==e){var X=Z[V]|Z[V+1]<<8|Z[V+2]<<16|Z[V+3]<<24;V+=4}else{var X=me.XMLParser.getIntAttribute(Z[V++],h)}if(X>0){this.setTile(U,ab,X);if(this.visible){this.tileset.drawTile(this.layerSurface,U*this.tilewidth,ab*this.tileheight,this.layerData[U][ab].tileId-this.tileset.firstgid)}}else{}}}};d.prototype.clearTile=function(U,V){me.TiledLayer.prototype.clearTile.call(this,U,V);this.layerSurface.clearRect(U*this.tilewidth,V*this.tileheight,this.tilewidth,this.tileheight)};d.prototype.draw=function(V,U,W){V.drawImage(this.layerCanvas,this.vp.pos.x,this.vp.pos.y,this.vp.width,this.vp.height,U,W,this.vp.width,this.vp.height)};function i(V,U,Y,Z){this.objects=[];this.name=V;this.width=me.XMLParser.getIntAttribute(U,L);this.height=me.XMLParser.getIntAttribute(U,J);this.z=Z;var X=U.getElementsByTagName(t);for(var W=0;W<X.length;W++){this.objects.push(new b(X[W],Y,Z))}}i.prototype.getObjectCount=function(){return this.objects.length};i.prototype.getObjectByIndex=function(U){return this.objects[U]};function b(V,U,W){this.name=me.XMLParser.getStringAttribute(V,E);this.x=me.XMLParser.getIntAttribute(V,C);this.y=me.XMLParser.getIntAttribute(V,B);this.z=W;this.gid=me.XMLParser.getIntAttribute(V,h,null);if(this.gid){this.width=U.tilewidth;this.height=U.tileheight;this.spritewidth=this.width;this.y-=this.height;this.image=U.getTileImage(this.gid-U.firstgid)}else{this.width=me.XMLParser.getIntAttribute(V,L,0);this.height=me.XMLParser.getIntAttribute(V,J,0)}f(this,V)}b.prototype.getObjectPropertyByName=function(U){return this[U]};D.me.TMXTileMap=K})(window);
/*!
 * Tween JS
 * https://github.com/sole/Tween.js
 *
 * author sole / http://soledadpenades.com
 * author mr.doob / http://mrdoob.com
 * author Robert Eisele / http://www.xarg.org
 * author Philippe / http://philippe.elsass.me
 * author Robert Penner / http://www.robertpenner.com/easing_terms_of_use.html
 */
(function(a,b){Tween=function(g){var o=g,m={},j={},k={},h=1000,l=0,d=null,q=Tween.Easing.Linear.EaseNone,f=null,i=null,e=null;this.to=function(s,u){if(u!==null){h=u}for(var t in s){if(o[t]===null){continue}k[t]=s[t]}return this};this.start=function(){me.game.add(this,999);d=me.timer.getTime()+l;for(var s in k){if(o[s]===null){continue}m[s]=o[s];j[s]=k[s]-o[s]}return this};this.stop=function(){this.destroy();return this};this.delay=function(s){l=s;return this};this.easing=function(s){q=s;return this};this.chain=function(s){f=s};this.onUpdate=function(s){i=s;return this};this.onComplete=function(s){e=s;return this};this.update=function(){var u,s,t;var v=me.timer.getTime();if(v<d){return true}s=(v-d)/h;s=s>1?1:s;t=q(s);for(u in j){o[u]=m[u]+j[u]*t}if(i!==null){i.call(o,t)}if(s==1){this.destroy();if(e!==null){e.call(o)}if(f!==null){f.start()}return false}return true};this.destroy=function(){me.game.remove(this)}};Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};Tween.Easing.Linear.EaseNone=function(d){return d};Tween.Easing.Quadratic.EaseIn=function(d){return d*d};Tween.Easing.Quadratic.EaseOut=function(d){return -d*(d-2)};Tween.Easing.Quadratic.EaseInOut=function(d){if((d*=2)<1){return 0.5*d*d}return -0.5*(--d*(d-2)-1)};Tween.Easing.Cubic.EaseIn=function(d){return d*d*d};Tween.Easing.Cubic.EaseOut=function(d){return --d*d*d+1};Tween.Easing.Cubic.EaseInOut=function(d){if((d*=2)<1){return 0.5*d*d*d}return 0.5*((d-=2)*d*d+2)};Tween.Easing.Quartic.EaseIn=function(d){return d*d*d*d};Tween.Easing.Quartic.EaseOut=function(d){return -(--d*d*d*d-1)};Tween.Easing.Quartic.EaseInOut=function(d){if((d*=2)<1){return 0.5*d*d*d*d}return -0.5*((d-=2)*d*d*d-2)};Tween.Easing.Quintic.EaseIn=function(d){return d*d*d*d*d};Tween.Easing.Quintic.EaseOut=function(d){return(d=d-1)*d*d*d*d+1};Tween.Easing.Quintic.EaseInOut=function(d){if((d*=2)<1){return 0.5*d*d*d*d*d}return 0.5*((d-=2)*d*d*d*d+2)};Tween.Easing.Sinusoidal.EaseIn=function(d){return -Math.cos(d*Math.PI/2)+1};Tween.Easing.Sinusoidal.EaseOut=function(d){return Math.sin(d*Math.PI/2)};Tween.Easing.Sinusoidal.EaseInOut=function(d){return -0.5*(Math.cos(Math.PI*d)-1)};Tween.Easing.Exponential.EaseIn=function(d){return d==0?0:Math.pow(2,10*(d-1))};Tween.Easing.Exponential.EaseOut=function(d){return d==1?1:-Math.pow(2,-10*d)+1};Tween.Easing.Exponential.EaseInOut=function(d){if(d==0){return 0}if(d==1){return 1}if((d*=2)<1){return 0.5*Math.pow(2,10*(d-1))}return 0.5*(-Math.pow(2,-10*(d-1))+2)};Tween.Easing.Circular.EaseIn=function(d){return -(Math.sqrt(1-d*d)-1)};Tween.Easing.Circular.EaseOut=function(d){return Math.sqrt(1- --d*d)};Tween.Easing.Circular.EaseInOut=function(d){if((d/=0.5)<1){return -0.5*(Math.sqrt(1-d*d)-1)}return 0.5*(Math.sqrt(1-(d-=2)*d)+1)};Tween.Easing.Elastic.EaseIn=function(e){var f,d=0.1,g=0.4;if(e==0){return 0}if(e==1){return 1}if(!g){g=0.3}if(!d||d<1){d=1;f=g/4}else{f=g/(2*Math.PI)*Math.asin(1/d)}return -(d*Math.pow(2,10*(e-=1))*Math.sin((e-f)*(2*Math.PI)/g))};Tween.Easing.Elastic.EaseOut=function(e){var f,d=0.1,g=0.4;if(e==0){return 0}if(e==1){return 1}if(!g){g=0.3}if(!d||d<1){d=1;f=g/4}else{f=g/(2*Math.PI)*Math.asin(1/d)}return(d*Math.pow(2,-10*e)*Math.sin((e-f)*(2*Math.PI)/g)+1)};Tween.Easing.Elastic.EaseInOut=function(e){var f,d=0.1,g=0.4;if(e==0){return 0}if(e==1){return 1}if(!g){g=0.3}if(!d||d<1){d=1;f=g/4}else{f=g/(2*Math.PI)*Math.asin(1/d)}if((e*=2)<1){return -0.5*(d*Math.pow(2,10*(e-=1))*Math.sin((e-f)*(2*Math.PI)/g))}return d*Math.pow(2,-10*(e-=1))*Math.sin((e-f)*(2*Math.PI)/g)*0.5+1};Tween.Easing.Back.EaseIn=function(d){var e=1.70158;return d*d*((e+1)*d-e)};Tween.Easing.Back.EaseOut=function(d){var e=1.70158;return(d=d-1)*d*((e+1)*d+e)+1};Tween.Easing.Back.EaseInOut=function(d){var e=1.70158*1.525;if((d*=2)<1){return 0.5*(d*d*((e+1)*d-e))}return 0.5*((d-=2)*d*((e+1)*d+e)+2)};Tween.Easing.Bounce.EaseIn=function(d){return 1-Tween.Easing.Bounce.EaseOut(1-d)};Tween.Easing.Bounce.EaseOut=function(d){if((d/=1)<(1/2.75)){return 7.5625*d*d}else{if(d<(2/2.75)){return 7.5625*(d-=(1.5/2.75))*d+0.75}else{if(d<(2.5/2.75)){return 7.5625*(d-=(2.25/2.75))*d+0.9375}else{return 7.5625*(d-=(2.625/2.75))*d+0.984375}}}};Tween.Easing.Bounce.EaseInOut=function(d){if(d<0.5){return Tween.Easing.Bounce.EaseIn(d*2)*0.5}return Tween.Easing.Bounce.EaseOut(d*2-1)*0.5+0.5};a.me.Tween=Tween})(window);